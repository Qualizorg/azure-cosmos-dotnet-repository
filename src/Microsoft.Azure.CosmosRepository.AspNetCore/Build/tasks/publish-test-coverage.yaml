parameters:
- name: ExcludeClasses
  displayName: Semicolon list of classes to exclude
  type: string
steps:
- task: CmdLine@2
  displayName: Install ReportGenerator
  inputs:
    script: 'dotnet tool install -g dotnet-reportgenerator-globaltool'
- task: PowerShell@2
  displayName: 'Execute ReportGenerator Code Coverage Command'
  inputs:
    targetType: 'inline'
    script: 'reportgenerator -reports:$(Agent.TempDirectory)/**/coverage.cobertura.xml -targetdir:$(Build.SourcesDirectory)/coverlet/reports -reporttypes:"Html;HtmlInline_AzurePipelines;Badges;Cobertura" -classfilters:"${{ parameters.ExcludeClasses }}"'
    errorActionPreference: 'silentlyContinue'
    ignoreLASTEXITCODE: true 
- task: PublishCodeCoverageResults@1
  displayName: 'Public Code Coverage Results'
  inputs:
    codeCoverageTool: 'Cobertura'
    summaryFileLocation: '$(Build.SourcesDirectory)/coverlet/reports/Cobertura.xml'